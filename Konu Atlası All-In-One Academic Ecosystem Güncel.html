<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Ecosystem v4.9.1 - Optimized</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Caveat:wght@700&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f1f5f9; margin: 0; padding: 0; }

        #pdf-render-area {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            background: #ffffff;
            padding: 15mm;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            position: relative;
        }

        .track-table, .plan-table { 
            table-layout: fixed; 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px;
        }

        .track-table th, .track-table td, .plan-table th, .plan-table td { 
            border: 1px solid #cbd5e1; 
            padding: 10px; 
            vertical-align: top; 
            word-wrap: break-word; 
            line-height: 1.4; 
            font-size: 10pt; 
        }

        /* Plan tablosunda alt satÄ±r desteÄŸi */
        .plan-table td {
            white-space: pre-wrap;
            min-height: 80px;
        }

        .track-table th, .plan-table th { 
            background: #f8fafc; 
            font-size: 9pt; 
            font-weight: 800; 
            color: #475569; 
        }

        .badge-tyt { background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe; padding: 2px 6px; border-radius: 4px; font-weight: 800; font-size: 7pt; display: inline-block; }
        .badge-ayt { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; padding: 2px 6px; border-radius: 4px; font-weight: 800; font-size: 7pt; display: inline-block; }

        .coach-note { font-family: 'Caveat', cursive; font-size: 20pt; color: #2563eb; line-height: 1.1; white-space: pre-wrap; }
        
        @media print { 
            .no-print-item { display: none !important; } 
        }
    </style>
</head>
<body class="py-10 px-4">

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-4 space-y-5 no-print-ui">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                <h2 class="text-xl font-bold text-blue-600 mb-4 italic uppercase tracking-tighter">Rehberlik Paneli</h2>
                <div class="space-y-3">
                    <input type="text" id="inStudent" oninput="updatePreview()" placeholder="Ã–ÄŸrenci Ad Soyad" class="w-full rounded-2xl p-4 bg-slate-50 ring-1 ring-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
                    <input type="text" id="inInst" oninput="updatePreview()" placeholder="Kurum Bilgisi" class="w-full rounded-2xl p-4 bg-slate-50 ring-1 ring-slate-200 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                <div class="flex gap-1 mb-6 p-1.5 bg-slate-100 rounded-2xl">
                    <button onclick="setTab('TAKIP')" id="btnTAKIP" class="flex-1 py-3 rounded-xl font-bold text-[10px] bg-white shadow-sm transition-all uppercase">Konu Takip</button>
                    <button onclick="setTab('PLAN')" id="btnPLAN" class="flex-1 py-3 rounded-xl font-bold text-[10px] text-slate-500 transition-all uppercase">HaftalÄ±k Plan</button>
                    <button onclick="setTab('EXTRA')" id="btnEXTRA" class="flex-1 py-3 rounded-xl font-bold text-[10px] text-slate-500 transition-all uppercase">DiÄŸer</button>
                </div>

                <div id="tabTAKIP" class="space-y-4">
                    <div class="flex gap-2">
                         <button onclick="toggleExam('TYT')" id="subTYT" class="flex-1 py-2 rounded-lg bg-blue-600 text-white text-[10px] font-bold">TYT</button>
                         <button onclick="toggleExam('AYT')" id="subAYT" class="flex-1 py-2 rounded-lg bg-slate-200 text-slate-600 text-[10px] font-bold">AYT</button>
                    </div>
                    <select id="inDers" onchange="updateKonuOptions()" class="w-full rounded-2xl p-4 bg-slate-50 ring-1 ring-slate-200 outline-none"></select>
                    <select id="inKonu" class="w-full rounded-2xl p-4 bg-slate-50 ring-1 ring-slate-200 outline-none"></select>
                    <input type="text" id="inKaynak" placeholder="Kaynak / Ã–dev Notu" class="w-full rounded-2xl p-4 bg-slate-50 ring-1 ring-slate-200 outline-none">
                    <button onclick="addRow()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-lg hover:bg-blue-700 transition-colors">Listeye Ekle</button>
                </div>

                <div id="tabPLAN" class="hidden space-y-2">
                    <p class="text-[10px] text-slate-400 mb-2">* Enter tuÅŸu ile alt satÄ±ra geÃ§ebilirsiniz.</p>
                    <textarea id="pazartesi" oninput="updatePreview()" placeholder="Pazartesi" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                    <textarea id="sali" oninput="updatePreview()" placeholder="SalÄ±" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                    <textarea id="carsamba" oninput="updatePreview()" placeholder="Ã‡arÅŸamba" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                    <textarea id="persembe" oninput="updatePreview()" placeholder="PerÅŸembe" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                    <textarea id="cuma" oninput="updatePreview()" placeholder="Cuma" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                    <textarea id="cumartesi" oninput="updatePreview()" placeholder="Cumartesi" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                    <textarea id="pazar" oninput="updatePreview()" placeholder="Pazar" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-100 text-sm outline-none" rows="2"></textarea>
                </div>

                <div id="tabEXTRA" class="hidden space-y-4">
                    <button onclick="addExtraInput('taskContainer')" class="w-full py-2 bg-slate-100 rounded-xl text-[10px] font-bold">+ GÃ–REV EKLE</button>
                    <div id="taskContainer" class="space-y-2"></div>
                    <button onclick="addExtraInput('qrContainer')" class="w-full py-2 bg-slate-100 rounded-xl text-[10px] font-bold">+ QR KOD EKLE</button>
                    <div id="qrContainer" class="space-y-2"></div>
                    <textarea id="coachMsg" oninput="updatePreview()" class="w-full rounded-xl p-3 bg-slate-50 ring-1 ring-slate-200 outline-none coach-note" style="font-size: 14pt" placeholder="Rehberlik MesajÄ±nÄ±z..."></textarea>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2">
                <button onclick="togglePreviewMode()" class="w-full bg-white border border-slate-200 text-slate-900 font-bold py-4 rounded-2xl hover:bg-slate-50 uppercase text-xs">
                    GÃ¶rÃ¼nÃ¼m: <span id="previewPill" class="text-blue-600">Hepsi</span>
                </button>
                <button onclick="downloadPDF()" class="w-full bg-slate-900 text-white font-bold py-4 rounded-2xl hover:bg-black shadow-xl uppercase text-xs">PDF Kaydet</button>
            </div>
        </div>

        <div class="lg:col-span-8 flex justify-center">
            <div id="pdf-render-area" class="shadow-2xl">
                <div class="flex justify-between items-start border-b-2 border-slate-100 pb-4 mb-6">
                    <div>
                        <h1 class="text-2xl font-black text-slate-900 tracking-tighter uppercase italic">Konu AtlasÄ± <span class="text-blue-600">Academic</span></h1>
                        <p class="text-slate-400 font-bold uppercase tracking-[0.2em] text-[8px]">Academic Monitoring - Bu uygulama Uzm Psk. Dan. Ali AVÅžAROÄžLU tarafÄ±ndan SADECE REHBER Ã–ÄžRETMENLERÄ°N kullanmasÄ± amacÄ±yla geliÅŸtirilmiÅŸtir.</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-xl text-slate-900" id="outStudent">Ã–ÄŸrenci AdÄ±</p>
                        <p class="text-[10px] font-semibold text-blue-600" id="outInst">Kurum Bilgisi</p>
                        <p class="text-[9px] text-slate-400 mt-1" id="outDate"></p>
                    </div>
                </div>

                <div id="viewTrack">
                    <table class="track-table">
                        <thead>
                            <tr>
                                <th style="width: 25%">SÄ±nav / Ders</th>
                                <th style="width: 45%">BranÅŸ / Konu</th>
                                <th style="width: 25%">Ã–dev Notu</th>
                                <th class="no-print-item" style="width: 5%"></th>
                            </tr>
                        </thead>
                        <tbody id="outTable"></tbody>
                    </table>
                </div>

                <div id="viewPlan">
                    <table class="plan-table">
                        <thead>
                            <tr>
                                <th>PZT</th><th>SALI</th><th>Ã‡AR</th><th>PER</th><th>CUMA</th><th>CMT</th><th>PAZ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="cell-pazartesi"></td>
                                <td id="cell-sali"></td>
                                <td id="cell-carsamba"></td>
                                <td id="cell-persembe"></td>
                                <td id="cell-cuma"></td>
                                <td id="cell-cumartesi"></td>
                                <td id="cell-pazar"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="grid grid-cols-12 gap-4 border-t border-slate-100 pt-6 mt-auto">
                    <div class="col-span-5 bg-slate-50 p-4 rounded-2xl border border-slate-100 min-h-[120px]">
                        <h3 class="text-[9px] font-black text-slate-900 uppercase mb-3 tracking-widest">HaftalÄ±k GÃ¶revler</h3>
                        <div id="outTasks" class="space-y-2"></div>
                    </div>
                    <div class="col-span-4 flex flex-col justify-between">
                        <div>
                            <h3 class="text-[9px] font-black text-slate-900 uppercase mb-1 italic">Rehberlik MesajÄ±</h3>
                            <div id="outCoachMsg" class="coach-note"></div>
                        </div>
                        <div id="outQrs" class="flex flex-wrap gap-2 mt-2"></div>
                    </div>
                    <div class="col-span-3 bg-blue-600 p-4 rounded-2xl text-white text-center flex flex-col justify-center shadow-lg">
                        <h3 class="text-[8px] font-black uppercase mb-3">Net Takibi</h3>
                        <div class="space-y-2 text-[10px]">
                            <p class="border-b border-blue-400 pb-1 flex justify-between"><span>TYT:</span> <span>.....</span></p>
                            <p class="border-b border-blue-400 pb-1 flex justify-between"><span>AYT:</span> <span>.....</span></p>
                        </div>
                    </div>
                </div>

                <div class="pt-6 flex justify-between items-end border-t border-slate-50 mt-6">
                    <p class="text-[8px] text-slate-300 font-bold uppercase tracking-widest italic">Uzm. Psk. Dan. Ali AvÅŸaroÄŸlu | Academic Ecosystem</p>
                    <p class="text-[8px] text-slate-300 font-bold text-right">_________________________<br>Ä°MZA</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DERS_IKONLARI = { "Matematik": "ðŸ“", "Geometri": "ðŸ“", "Fizik": "âš›ï¸", "Kimya": "ðŸ§ª", "Biyoloji": "ðŸ§¬", "TÃ¼rkÃ§e": "ðŸ“š", "Tarih": "ðŸ“œ", "CoÄŸrafya": "ðŸŒ", "Edebiyat": "ðŸ–‹ï¸" };
        const GEOMETRI = ["DoÄŸruda AÃ§Ä±lar", "ÃœÃ§gende AÃ§Ä±lar", "Ã–zel ÃœÃ§genler", "Dik ÃœÃ§gen", "Ä°kizkenar ÃœÃ§gen", "EÅŸkenar ÃœÃ§gen", "AÃ§Ä±ortay", "Kenarortay", "EÅŸlik ve Benzerlik", "ÃœÃ§gende Alan", "ÃœÃ§gende Benzerlik", "AÃ§Ä± Kenar BaÄŸÄ±ntÄ±larÄ±", "Ã‡okgenler", "Ã–zel DÃ¶rtgenler", "DÃ¶rtgenler", "Deltoid", "Paralelkenar", "EÅŸkenar DÃ¶rtgen", "DikdÃ¶rtgen", "Kare", "Yamuk", "Ã‡ember ve Daire", "Ã‡emberde AÃ§Ä±", "Ã‡emberde Uzunluk", "Dairede Ã‡evre ve Alan", "Analitik Geometri", "NoktanÄ±n AnalitiÄŸi", "DoÄŸrunun AnalitiÄŸi", "DÃ¶nÃ¼ÅŸÃ¼m Geometrisi", "Ã‡emberin AnalitiÄŸi", "KatÄ± Cisimler", "Prizmalar", "KÃ¼p", "Silindir", "Piramit", "Koni", "KÃ¼re", "Geometri Genel Tekrar"];
        const TARÄ°H_ORTAK = ["Tarih ve Zaman", "Ä°nsanlÄ±ÄŸÄ±n Ä°lk DÃ¶nemleri", "Ä°lk ve Orta Ã‡aÄŸlarda TÃ¼rk DÃ¼nyasÄ±", "Ä°slam Medeniyetinin DoÄŸuÅŸu ve Ä°lk Ä°slam Devletleri", "TÃ¼rklerin Ä°slamiyetâ€™i KabulÃ¼ ve Ä°lk TÃ¼rk Ä°slam Devletleri", "Orta Ã‡aÄŸâ€™da DÃ¼nya", "SelÃ§uklu TÃ¼rkiyesi", "OsmanlÄ± Siyaseti", "DevletleÅŸme SÃ¼recinde SavaÅŸÃ§Ä±lar", "Beylikten Devlete OsmanlÄ± Medeniyeti", "DÃ¼nya GÃ¼cÃ¼ OsmanlÄ±", "Sultan ve OsmanlÄ± Merkez TeÅŸkilatÄ±", "Klasik Ã‡aÄŸda OsmanlÄ± Toplum DÃ¼zeni", "DeÄŸiÅŸen DÃ¼nya Dengeleri", "DeÄŸiÅŸim Ã‡aÄŸÄ±nda Avrupa ve OsmanlÄ±", "UluslararasÄ± Ä°liÅŸkilerde Denge Stratejisi", "Devrimler Ã‡aÄŸÄ±nda Devlet-Toplum", "Sermaye ve Emek", "XIX. ve XX. YÃ¼zyÄ±lda GÃ¼ndelik Hayat", "XX. YÃ¼zyÄ±l BaÅŸlarÄ±nda OsmanlÄ± ve DÃ¼nya", "Milli MÃ¼cadele", "AtatÃ¼rkÃ§Ã¼lÃ¼k ve TÃ¼rk Ä°nkÄ±labÄ±", "Tarih Genel Tekrar"];

        const ALL_DATA = {
            "TYT": {
                "TÃ¼rkÃ§e": ["SÃ¶zcÃ¼kte Anlam", "SÃ¶z Yorumu", "Deyim ve AtasÃ¶zÃ¼", "CÃ¼mlede Anlam", "Paragraf", "Paragrafta YapÄ±", "Paragrafta Konu-Ana DÃ¼ÅŸÃ¼nce", "Paragrafta YardÄ±mcÄ± DÃ¼ÅŸÃ¼nce", "Ses Bilgisi", "YazÄ±m KurallarÄ±", "Noktalama Ä°ÅŸaretleri", "SÃ¶zcÃ¼kte YapÄ±/Ekler", "Ä°simler", "Zamirler", "SÄ±fatlar", "Zarflar", "Edat â€“ BaÄŸlaÃ§ â€“ Ãœnlem", "Fiiller", "Ek Fiil", "Fiilimsi", "Fiilde Ã‡atÄ±", "CÃ¼mlenin Ã–geleri", "CÃ¼mle TÃ¼rleri", "AnlatÄ±m BozukluÄŸu", "Dil Bilgisi Genel Tekrar"],
                "Matematik": ["Temel Kavramlar", "SayÄ± BasamaklarÄ±", "BÃ¶lme ve BÃ¶lÃ¼nebilme", "EBOB â€“ EKOK", "Rasyonel SayÄ±lar", "Basit EÅŸitsizlikler", "Mutlak DeÄŸer", "ÃœslÃ¼ SayÄ±lar", "KÃ¶klÃ¼ SayÄ±lar", "Ã‡arpanlara AyÄ±rma", "Problemler", "KÃ¼meler", "MantÄ±k", "Fonksiyonlar", "Polinomlar", "2.Dereceden Denklemler", "PermÃ¼tasyon ve Kombinasyon", "OlasÄ±lÄ±k", "Veri â€“ Ä°statistik", "Matematik Genel Tekrar"],
                "Geometri": GEOMETRI,
                "Fizik": ["Fizik Bilimine GiriÅŸ", "Madde ve Ã–zellikleri", "BasÄ±nÃ§", "KaldÄ±rma Kuvveti", "IsÄ± ve SÄ±caklÄ±k", "Hareket", "Kuvvet", "Ä°ÅŸ-GÃ¼Ã§-Enerji", "Elektrik", "Manyetizma", "Dalgalar", "Optik", "Fizik Genel Tekrar"],
                "Kimya": ["Kimya Bilimi", "Atom ve Periyodik Sistem", "Kimyasal TÃ¼rler ArasÄ± EtkileÅŸimler", "Maddenin Halleri", "DoÄŸa ve Kimya", "KimyanÄ±n Temel KanunlarÄ±", "Mol", "Kimyasal Hesaplamalar", "KarÄ±ÅŸÄ±mlar", "Asit, Baz ve Tuz", "Kimya Her Yerde", "Kimya Genel Tekrar"],
                "Biyoloji": ["CanlÄ±larÄ±n Ortak Ã–zellikleri", "CanlÄ±larÄ±n Temel BileÅŸenleri", "HÃ¼cre ve Organeller", "Madde GeÃ§iÅŸleri", "CanlÄ±larÄ±n SÄ±nÄ±flandÄ±rÄ±lmasÄ±", "HÃ¼crede BÃ¶lÃ¼nme â€“ Ãœreme", "KalÄ±tÄ±m", "Ekosistem", "Biyoloji Genel Tekrar"],
                "Tarih": TARÄ°H_ORTAK,
                "CoÄŸrafya": ["DoÄŸa ve Ä°nsan", "DÃ¼nyaâ€™nÄ±n Åžekli ve Hareketleri", "CoÄŸrafi Konum", "Harita Bilgisi", "Ä°klimler", "BasÄ±nÃ§ ve RÃ¼zgarlar", "Atmosfer ve SÄ±caklÄ±k", "Nem, YaÄŸÄ±ÅŸ ve BuharlaÅŸma", "Ä°Ã§ Kuvvetler", "DÄ±ÅŸ Kuvvetler", "Su â€“ Toprak ve Bitkiler", "NÃ¼fus", "GÃ¶Ã§", "YerleÅŸme", "TÃ¼rkiyeâ€™nin Yer Åžekilleri", "Ekonomik Faaliyetler", "BÃ¶lgeler", "UluslararasÄ± UlaÅŸÄ±m HatlarÄ±", "Ã‡evre ve Toplum", "DoÄŸal Afetler", "CoÄŸrafya Genel Tekrar"]
            },
            "AYT": {
                "Matematik": ["Fonksiyonlar", "Polinomlar", "2.Dereceden Denklemler", "PermÃ¼tasyon ve Kombinasyon", "Binom ve OlasÄ±lÄ±k", "KarmaÅŸÄ±k SayÄ±lar", "2.Dereceden EÅŸitsizlikler", "Parabol", "Trigonometri", "Logaritma", "Diziler", "Limit", "TÃ¼rev", "Ä°ntegral", "AYT Matematik Genel Tekrar"],
                "Geometri": GEOMETRI,
                "Edebiyat": ["Anlam Bilgisi", "Dil Bilgisi", "GÃ¼zel Sanatlar ve Edebiyat", "Metinlerin SÄ±nÄ±flandÄ±rÄ±lmasÄ±", "Åžiir Bilgisi", "Edebi Sanatlar", "TÃ¼rk EdebiyatÄ± DÃ¶nemleri", "Ä°slamiyet Ã–ncesi ve GeÃ§iÅŸ DÃ¶nemi", "Halk EdebiyatÄ±", "Divan EdebiyatÄ±", "Tanzimat EdebiyatÄ±", "Servet-i FÃ¼nun EdebiyatÄ±", "Fecr-i Ati EdebiyatÄ±", "Milli Edebiyat", "Cumhuriyet DÃ¶nemi EdebiyatÄ±", "Edebiyat AkÄ±mlarÄ±", "DÃ¼nya EdebiyatÄ±", "Edebiyat Genel Tekrar"],
                "Fizik": ["VektÃ¶rler", "Kuvvet, Tork ve Denge", "Basit Makineler", "Hareket", "Newtonâ€™un Hareket YasalarÄ±", "AtÄ±ÅŸlar", "Ä°tme ve Momentum", "Elektrik Alan ve Potansiyel", "Manyetik Alan", "Ä°ndÃ¼ksiyon", "Alternatif AkÄ±m", "Ã‡embersel Hareket", "AÃ§Ä±sal Momentum", "KÃ¼tle Ã‡ekim", "Basit Harmonik Hareket", "Dalga MekaniÄŸi", "Modern Fizik", "Fizik Genel Tekrar"],
                "Kimya": ["Modern Atom Teorisi", "Gazlar", "SÄ±vÄ± Ã‡Ã¶zeltiler", "Enerji", "HÄ±z", "Denge", "Asit-Baz Dengesi", "Ã‡Ã¶zÃ¼nÃ¼rlÃ¼k Dengesi", "Kimya ve Elektrik", "Karbon KimyasÄ±na GiriÅŸ", "Organik Kimya", "Kimya Genel Tekrar"],
                "Biyoloji": ["Sistemler (Sinir, Endokrin, Duyu, Destek)", "Sindirim Sistemi", "DolaÅŸÄ±m ve BaÄŸÄ±ÅŸÄ±klÄ±k", "Solunum Sistemi", "BoÅŸaltÄ±m Sistemi", "Ãœreme Sistemi", "KomÃ¼nite ve PopÃ¼lasyon Ekolojisi", "Genden Proteine", "Protein Sentezi", "Fotosentez ve Kemosentez", "HÃ¼cre Solunumu", "Bitki Biyolojisi", "Biyoloji Genel Tekrar"],
                "Tarih": TARÄ°H_ORTAK,
                "CoÄŸrafya": ["Ekosistem", "BiyoÃ§eÅŸitlilik", "NÃ¼fus PolitikalarÄ±", "TÃ¼rkiye Ekonomisi", "KÃ¼resel Ticaret", "Jeopolitik Konum", "BÃ¶lgesel Ã–rgÃ¼tler", "Ã‡evre ve Toplum", "CoÄŸrafya Genel Tekrar"]
            }
        };

        let currentExamMode = 'TYT';
        let allRows = [];
        let previewMode = 'BOTH'; 

        function setTab(tab) {
            ['TAKIP', 'PLAN', 'EXTRA'].forEach(t => {
                document.getElementById('tab' + t).classList.add('hidden');
                document.getElementById('btn' + t).classList.remove('bg-white', 'shadow-sm');
                document.getElementById('btn' + t).classList.add('text-slate-500');
            });
            document.getElementById('tab' + tab).classList.remove('hidden');
            document.getElementById('btn' + tab).classList.add('bg-white', 'shadow-sm');
            document.getElementById('btn' + tab).classList.remove('text-slate-500');
        }

        function toggleExam(type) {
            currentExamMode = type;
            document.getElementById('subTYT').className = type === 'TYT' ? 'flex-1 py-2 rounded-lg bg-blue-600 text-white text-[10px] font-bold' : 'flex-1 py-2 rounded-lg bg-slate-200 text-slate-600 text-[10px] font-bold';
            document.getElementById('subAYT').className = type === 'AYT' ? 'flex-1 py-2 rounded-lg bg-red-600 text-white text-[10px] font-bold' : 'flex-1 py-2 rounded-lg bg-slate-200 text-slate-600 text-[10px] font-bold';
            updateDersOptions();
        }

        function updateDersOptions() {
            const d = document.getElementById('inDers'); d.innerHTML = "";
            Object.keys(ALL_DATA[currentExamMode]).forEach(ders => {
                let opt = document.createElement('option'); opt.value = ders; opt.innerText = (DERS_IKONLARI[ders] || "") + " " + ders;
                d.appendChild(opt);
            });
            updateKonuOptions();
        }

        function updateKonuOptions() {
            const ders = document.getElementById('inDers').value;
            const k = document.getElementById('inKonu'); k.innerHTML = "";
            if(ALL_DATA[currentExamMode][ders]) {
                ALL_DATA[currentExamMode][ders].forEach(konu => {
                    let opt = document.createElement('option'); opt.value = konu; opt.innerText = konu;
                    k.appendChild(opt);
                });
            }
        }

        function addRow() {
            allRows.push({ 
                id: Date.now(), 
                exam: currentExamMode, 
                ders: document.getElementById('inDers').value, 
                konu: document.getElementById('inKonu').value, 
                kaynak: document.getElementById('inKaynak').value || "-" 
            });
            document.getElementById('inKaynak').value = "";
            updatePreview();
        }

        function deleteRow(id) { allRows = allRows.filter(r => r.id !== id); updatePreview(); }

        function addExtraInput(containerId) {
            const container = document.getElementById(containerId);
            const wrap = document.createElement('div');
            wrap.className = "flex gap-2";
            const input = document.createElement('input');
            input.type = 'text'; input.oninput = updatePreview;
            input.className = 'flex-1 rounded-xl p-2 bg-slate-50 ring-1 ring-slate-200 extra-input text-xs';
            input.dataset.type = containerId === 'taskContainer' ? 'task' : 'qr';
            
            const delBtn = document.createElement('button');
            delBtn.innerText = "âœ•"; delBtn.className = "text-red-400 px-2";
            delBtn.onclick = () => { wrap.remove(); updatePreview(); };

            wrap.appendChild(input); wrap.appendChild(delBtn);
            container.appendChild(wrap);
        }

        function togglePreviewMode(){
            if(previewMode === 'BOTH') previewMode = 'TRACK';
            else if(previewMode === 'TRACK') previewMode = 'PLAN';
            else previewMode = 'BOTH';
            updatePreview();
        }

        function updatePreview() {
            // Metin AlanlarÄ±
            document.getElementById('outStudent').innerText = document.getElementById('inStudent').value || "Ã–ÄŸrenci AdÄ±";
            document.getElementById('outInst').innerText = document.getElementById('inInst').value || "Kurum Bilgisi";
            document.getElementById('outDate').innerText = new Date().toLocaleDateString('tr-TR');
            document.getElementById('outCoachMsg').innerText = document.getElementById('coachMsg').value;

            // GÃ¼nler
            ['pazartesi', 'sali', 'carsamba', 'persembe', 'cuma', 'cumartesi', 'pazar'].forEach(gun => { 
                document.getElementById('cell-' + gun).innerText = document.getElementById(gun).value; 
            });

            // Takip Tablosu
            const table = document.getElementById('outTable'); table.innerHTML = "";
            allRows.forEach(r => {
                const tr = document.createElement('tr');
                const badge = r.exam === 'TYT' ? 'badge-tyt' : 'badge-ayt';
                tr.innerHTML = `
                    <td><div class="font-bold">${DERS_IKONLARI[r.ders] || ""} ${r.ders}</div><span class="${badge} mt-1">${r.exam}</span></td>
                    <td class="font-semibold text-slate-700">${r.konu}</td>
                    <td class="text-slate-500 italic">${r.kaynak}</td>
                    <td class="no-print-item text-center"><button onclick="deleteRow(${r.id})" class="text-red-400 hover:text-red-600">âœ•</button></td>
                `;
                table.appendChild(tr);
            });

            // GÃ¶revler ve QR Kodlar
            const outTasks = document.getElementById('outTasks'); outTasks.innerHTML = "";
            const outQrs = document.getElementById('outQrs'); outQrs.innerHTML = "";
            
            document.querySelectorAll('.extra-input').forEach((input, index) => {
                if(input.value) {
                    if(input.dataset.type === 'task') {
                        outTasks.innerHTML += `<div class="flex items-start gap-2 text-[10px] text-slate-600"><div class="w-2 h-2 border rounded mt-1 flex-shrink-0"></div><span>${input.value}</span></div>`;
                    } else {
                        const qrId = "qr-item-" + index;
                        const qrWrap = document.createElement('div');
                        qrWrap.id = qrId; qrWrap.className = "p-1 border rounded bg-white";
                        outQrs.appendChild(qrWrap);
                        new QRCode(qrWrap, { text: input.value, width: 45, height: 45 });
                    }
                }
            });

            // GÃ¶rÃ¼nÃ¼m Modu Uygula
            document.getElementById('viewTrack').style.display = (previewMode === 'PLAN') ? 'none' : 'block';
            document.getElementById('viewPlan').style.display = (previewMode === 'TRACK') ? 'none' : 'block';
            document.getElementById('previewPill').innerText = (previewMode === 'BOTH') ? 'Hepsi' : (previewMode === 'TRACK' ? 'Takip' : 'Plan');
        }

        function downloadPDF() {
            const student = document.getElementById('inStudent').value || "Program";
            const element = document.getElementById('pdf-render-area');

            // PDF motoru body padding'i ve "margin: 0 auto" gibi merkezleme stillerini
            // bazen sayfaya boÅŸluk olarak yansÄ±tÄ±yor. PDF alÄ±rken geÃ§ici olarak sÄ±fÄ±rlÄ±yoruz.
            const prevBodyPadding = document.body.style.padding;
            const prevBodyMargin = document.body.style.margin;
            const prevElMargin = element.style.margin;
            const prevElBoxShadow = element.style.boxShadow;

            document.body.style.padding = '0';
            document.body.style.margin = '0';
            element.style.margin = '0';
            element.style.boxShadow = 'none';

            const opt = {
                margin: [0, 0, 0, 0],
                filename: `${student}_Program.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    scrollY: 0
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf()
                .set(opt)
                .from(element)
                .save()
                .then(() => {
                    // Eski stilleri geri yÃ¼kle
                    document.body.style.padding = prevBodyPadding;
                    document.body.style.margin = prevBodyMargin;
                    element.style.margin = prevElMargin || '0 auto';
                    element.style.boxShadow = prevElBoxShadow;
                })
                .catch(() => {
                    // Hata olursa da eski stilleri geri yÃ¼kle
                    document.body.style.padding = prevBodyPadding;
                    document.body.style.margin = prevBodyMargin;
                    element.style.margin = prevElMargin || '0 auto';
                    element.style.boxShadow = prevElBoxShadow;
                });
        }

        window.onload = () => { toggleExam('TYT'); updatePreview(); };
    </script>
</body>
</html>